DBMS:
sql server

Error:
com.microsoft.sqlserver.jdbc.SQLServerException: The connection is closed.

SQL:
SELECT 

		row_id,


    time_id,
	
	covariate_id,
	value_as_number
INTO #meas_val_data
FROM (
	SELECT 

		cohort.row_id AS row_id,

		time_id,
		ROW_NUMBER() OVER (PARTITION BY cohort.row_id, measurement.measurement_concept_id, time_id ORDER BY measurement_date DESC) AS rn,


		covariate_id,
		value_as_number
	FROM #cohort_person cohort
	INNER JOIN ohdsi_cumc_deid_pending.dbo.measurement
		ON cohort.subject_id = measurement.person_id
	INNER JOIN #meas_cov meas_cov
		ON meas_cov.measurement_concept_id = measurement.measurement_concept_id 
			AND meas_cov.unit_concept_id = measurement.unit_concept_id 

	INNER JOIN #time_period time_period
		ON measurement_date <= DATEADD(DAY, time_period.end_day, cohort.cohort_start_date)
		AND measurement_date >= DATEADD(DAY, time_period.start_day, cohort.cohort_start_date)
	WHERE measurement.measurement_concept_id != 0 
	
		AND value_as_number IS NOT NULL 			

) temp
WHERE rn = 1

R version:
R version 3.4.0 (2017-04-21)

Platform:
x86_64-w64-mingw32

Attached base packages:
- stats
- graphics
- grDevices
- utils
- datasets
- methods
- base

Other attached packages: